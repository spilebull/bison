language: android
dist: trusty
jdk: oraclejdk8
sudo: false

# キャッシュクリア
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -rf $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
    - $HOME/.android/build-cache

# 環境変数
env:
 global:
   - DEPLOYGATE_USER=spilebull
   - DEPLOYGATE_TOKEN=db9cf7eeb4c263bea48d86793874628cc6bad781
   - DEPLOYGATE_DISTRIBUTION_KEY=cbfde9936959ad972e702e9e12c48678fe37301d
   - ANDROID_API=28
   - ANDROID_BUILD_TOOLS=28.0.3
   - ADB_INSTALL_TIMEOUT=5 # Minutes.

# 最新 Android SDKツールを使用
android:
  components:
    - tools
    - tools # tools を 2回実行 すると最新のビルドツールが取得される (https://github.com/codepath/android_guides/wiki/Setting-up-Travis-CI)
    - platform-tools
    - android-${ANDROID_API}
    - build-tools-${ANDROID_BUILD_TOOLS}
    - extra

# develop ブランチのみ実行
branches:
  only:
    - develop

# スクリプト実行処理
script:
  - ./gradlew clean build
  - ./gradlew check test jacocoTestReport
  - ./gradlew uploadDeployGateDebug

# 成功時のみ実行処理
after_success:
  - bash <(curl -s https://codecov.io/bash)

# 通知設定
notifications:
  email: false
  slack: false
